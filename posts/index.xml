<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on blog</title><link>/posts/</link><description>Recent content in Posts on blog</description><generator>Hugo -- gohugo.io</generator><language>en-gb</language><lastBuildDate>Sun, 03 Oct 2021 00:00:00 +0000</lastBuildDate><atom:link href="/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Westinghouse ceiling fan remote control with Home Assistant</title><link>/posts/ceiling-fan-control/</link><pubDate>Sun, 03 Oct 2021 00:00:00 +0000</pubDate><guid>/posts/ceiling-fan-control/</guid><description>
&lt;p>The Westinghouse Bendan ceiling fan comes with an infrared remote control (model number ID6) which is used to set the fan speed and turn the light on and off.&lt;/p>
&lt;p>I&amp;rsquo;ve wanted to control the fan speed via my phone for a while, and have managed to do this using &lt;a href="https://www.home-assistant.io">Home Assistant&lt;/a> and a &lt;a href="https://www.ibroadlink.com/rmMini3">Broadlink RM3 Mini&lt;/a>.&lt;/p>
&lt;h2 id="linking-the-rm3-mini-to-home-assistant">Linking the RM3 Mini to Home assistant&lt;/h2>
&lt;p>Adding the RM3 Mini to Home Assistant was relatively simple - but don&amp;rsquo;t bother with any of the instructions about setting up scripts as it&amp;rsquo;s easier to set the codes manually. &lt;a href="https://www.home-assistant.io/integrations/broadlink">Follow the guide&lt;/a> otherwise.&lt;/p>
&lt;p>Note that you will require your phone to be connected to an exclusively 2.4GHz WiFi network to set up the RM3 Mini - 2.4GHz and 5GHz WiFi on a single SSID will not work. Workarounds for this include walking away from your access point until your phone connects using the 2.4GHz band, setting up another 2.4GHz-only AP with the same SSID and password, or setting your APs to only broadcast 2.4GHz temporarily.&lt;/p>
&lt;h2 id="learning-codes">Learning codes&lt;/h2>
&lt;p>&lt;em>NB: you can try using my codes found below to save you from doing anything. Several models of this ceiling fan are available, and the one installed in my bedroom is one of the halogen models - if you have one of the LED models, your IR codes might be different.&lt;/em>&lt;/p>
&lt;p>With the RM3 Mini added to Home Assistant, it&amp;rsquo;s now time to learn codes. The easiest way to do this is with &lt;a href="https://github.com/mjg59/python-broadlink">python-broadlink&lt;/a> (&lt;a href="https://aur.archlinux.org/packages/python-broadlink">available in the AUR&lt;/a>). With that installed, run &lt;code>broadlink_discovery&lt;/code> which will scan your LAN and discover any connected Broadlink devices. One of the lines of output will start with &lt;code># broadlink_cli&lt;/code> - copy this as it will ne needed to learn the IR codes.&lt;/p>
&lt;p>Next, execute &lt;code>broadlink_cli --type 0x5f36 --host 172.16.1.12 --mac 001122aabbcc --learn&lt;/code>, point the ceiling fan remote at the RM3 Mini and press a button on the remote. You IR codes will be printed to your terminal and those can be used in Home Assistant.&lt;/p>
&lt;h2 id="adding-the-fan-to-home-assistant">Adding the fan to Home assistant&lt;/h2>
&lt;p>Adding fan actions to Home Assistant is - unfortunately - accomplished by adding each button as a switch. This is unfortunate because it makes state management a bit of a pain, but it works rather acceptably otherwise.&lt;/p>
&lt;p>I&amp;rsquo;ve set my fan up like so:&lt;/p>
&lt;ul>
&lt;li>Light
&lt;ul>
&lt;li>On and off are the same command as the button on the remote is a toggle&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Fan
&lt;ul>
&lt;li>A generic &amp;ldquo;fan&amp;rdquo; switch for Google Home to catch so that simple &amp;ldquo;turn the fan on/off&amp;rdquo; commands works. The on command sets the fan speed to low.&lt;/li>
&lt;li>A switch per fan speed for more granular control.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Adding the following &lt;code>switch&lt;/code> block below to my Home Assistant &lt;code>configuration.yaml&lt;/code> file, followed by a restart of Home Assistant, adds these switches and gives me remote control over my ceiling fan.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f92672">switch&lt;/span>:
- &lt;span style="color:#f92672">platform&lt;/span>: &lt;span style="color:#ae81ff">broadlink&lt;/span>
&lt;span style="color:#f92672">mac&lt;/span>: &lt;span style="color:#ae81ff">00&lt;/span>:&lt;span style="color:#ae81ff">11&lt;/span>:&lt;span style="color:#ae81ff">22&lt;/span>:&lt;span style="color:#ae81ff">aa:bb:cc&lt;/span>
&lt;span style="color:#f92672">switches&lt;/span>:
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Bedroom fan light&lt;/span>
&lt;span style="color:#f92672">command_on&lt;/span>: &lt;span style="color:#ae81ff">JgBoACMPKA8NKg8pDikOKQ8oDykqDQ0qDykOAAEGKA8oDw0qDykOKQ8oDygPKSgPDSoPKA8AAQYoDykODSsOKQ0qDSoNKwwrKA8NKg0rDAABCCgPKQ4NKw0qDSoNKg0rDikqDQ4pDykPAA0F&lt;/span>
&lt;span style="color:#f92672">command_off&lt;/span>: &lt;span style="color:#ae81ff">JgBoACMPKA8NKg8pDikOKQ8oDykqDQ0qDykOAAEGKA8oDw0qDykOKQ8oDygPKSgPDSoPKA8AAQYoDykODSsOKQ0qDSoNKwwrKA8NKg0rDAABCCgPKQ4NKw0qDSoNKg0rDikqDQ4pDykPAA0F&lt;/span>
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Bedroom fan&lt;/span>
&lt;span style="color:#f92672">command_on&lt;/span>: &lt;span style="color:#ae81ff">JgCSACQPKg0NKg0qDSsMKw0qDSoNKwwrDSop6ykPKg0NKg0qDSsMKw0qDSoNKwwrDSop6ykPKg0NKgwrDSsNKgwrDSoNKw0qDSop6ykPKg0MKw0qDSsNKg0qDSsMKw0qDCsp7CgPKg0OKQ0rDCsNKg0qDSsMKw0qDSop7CgPKg0OKQwsDCsNKg0qDSsNKgwrDSopAA0F&lt;/span>
&lt;span style="color:#f92672">command_off&lt;/span>: &lt;span style="color:#ae81ff">JgCcACQPKA8NKg0qDSoNKw0qKQ4OKgwrDSoNAAEHKQ8pDgwrDSoNKw0qDSopDg8pDSoNKg0AAQcpDyoNDSoNKg0rDSoMKykODioNKg0qDAABCScQKA8NKg0rDCsNKg0qKQ8MKw0qDSoNAAEIKA8oDwwrDSsNKg0qDCspDwwrDSoNKg0AAQgoDykODCsNKw0qDSoNKigQDCsMKw0qDQANBQ==&lt;/span>
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Bedroom fan slow&lt;/span>
&lt;span style="color:#f92672">command_on&lt;/span>: &lt;span style="color:#ae81ff">JgCSACQPKg0NKg0qDSsMKw0qDSoNKwwrDSop6ykPKg0NKg0qDSsMKw0qDSoNKwwrDSop6ykPKg0NKgwrDSsNKgwrDSoNKw0qDSop6ykPKg0MKw0qDSsNKg0qDSsMKw0qDCsp7CgPKg0OKQ0rDCsNKg0qDSsMKw0qDSop7CgPKg0OKQwsDCsNKg0qDSsNKgwrDSopAA0F&lt;/span>
&lt;span style="color:#f92672">command_off&lt;/span>: &lt;span style="color:#ae81ff">JgCcACQPKA8NKg0qDSoNKw0qKQ4OKgwrDSoNAAEHKQ8pDgwrDSoNKw0qDSopDg8pDSoNKg0AAQcpDyoNDSoNKg0rDSoMKykODioNKg0qDAABCScQKA8NKg0rDCsNKg0qKQ8MKw0qDSoNAAEIKA8oDwwrDSsNKg0qDCspDwwrDSoNKg0AAQgoDykODCsNKw0qDSoNKigQDCsMKw0qDQANBQ==&lt;/span>
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Bedroom fan medium&lt;/span>
&lt;span style="color:#f92672">command_on&lt;/span>: &lt;span style="color:#ae81ff">JgCcACYNKQ4NKgwrDSsNKg0qDSoNKyoNDSoPAAEFKQ8pDg0qDCwMKw0qDSoNKwwrKg0MKw0AAQgqDS0KDikNKw4pDCsNKg0rDSoqDQ4pDQABCCgPKQ4OKQ0rDSoNKg0qDSsNKikODikNAAEIKA8qDQ4qDCsNKg0qDSsMKw0qKQ4OKgwAAQgoDykODioNKg0qDCsNKwwrDSopDg4qDAANBQ==&lt;/span>
&lt;span style="color:#f92672">command_off&lt;/span>: &lt;span style="color:#ae81ff">JgCcACQPKA8NKg0qDSoNKw0qKQ4OKgwrDSoNAAEHKQ8pDgwrDSoNKw0qDSopDg8pDSoNKg0AAQcpDyoNDSoNKg0rDSoMKykODioNKg0qDAABCScQKA8NKg0rDCsNKg0qKQ8MKw0qDSoNAAEIKA8oDwwrDSsNKg0qDCspDwwrDSoNKg0AAQgoDykODCsNKw0qDSoNKigQDCsMKw0qDQANBQ==&lt;/span>
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Bedroom fan fast&lt;/span>
&lt;span style="color:#f92672">command_on&lt;/span>: &lt;span style="color:#ae81ff">JgCSACQOKQ8MKwwrDSopDwwrDCsNKg0rKA8o7CkOKQ8NKg0qDSopDwwrDSoNKg0rKA8o7CkOKw0NKg0qDSopDw0qDSoNKg0rKA8p6ykPKA8NKg0qDSsoDwwrDSoNKwwrKA8p6ykPKA8NKg0qDSsoDwwrDSoNKw0qKA8p6ykPKg0NKg0qDSsoDwwrDSsMKw0qKQ4pAA0F&lt;/span>
&lt;span style="color:#f92672">command_off&lt;/span>: &lt;span style="color:#ae81ff">JgCcACQPKA8NKg0qDSoNKw0qKQ4OKgwrDSoNAAEHKQ8pDgwrDSoNKw0qDSopDg8pDSoNKg0AAQcpDyoNDSoNKg0rDSoMKykODioNKg0qDAABCScQKA8NKg0rDCsNKg0qKQ8MKw0qDSoNAAEIKA8oDwwrDSsNKg0qDCspDwwrDSoNKg0AAQgoDykODCsNKw0qDSoNKigQDCsMKw0qDQANBQ==&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>